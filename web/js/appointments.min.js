"use strict";function inputEvent(){$('input[name="docname"]').on("change",function(e){e.preventDefault(),$(".appoint-time").html(""),$(this).is(":checked")?($("#doctor").removeClass("hidden"),$("#doctor").val($(this).data("docname")),$("#doctor_id").val($(this).val()),$(this).prop("checked",!0),$("#exampleModal3").modal("hide"),dateList=[],GetSchedules($(this).val())):($("#doctor").val(""),$("#doctor_id").val(""),$(this).prop("checked",!1),$("#exampleModal3").modal("hide"))})}function GetSchedules(e){$("#appoint-form").waitMe({effect:"roundBounce",color:"#ff518a"}),$.ajax({method:"POST",url:"/app/appoint/schedules",data:Object.assign({doc_id:e},yii.getQueryParams(window.location.search)),dataType:"json",success:function(e){daysOfWeekDisabled=e.daysOfWeekDisabled,holidays=e.holidays,jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setDaysOfWeekDisabled",e.daysOfWeekDisabled),jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setDatesDisabled",e.datesDisabled),$("#appoint-form").waitMe("hide")},error:function(e,t,o){$("#appoint-form").waitMe("hide"),Swal.fire({title:"Error!",text:o,icon:"error",confirmButtonText:"ตกลง"})}})}function GetScheduleTimes(e){$("#appoint-form").waitMe({effect:"roundBounce",color:"#ff518a"});var t=objectifyForm();$.ajax({method:"POST",url:"/app/appoint/schedule-times",data:Object.assign({},{...t,appoint_date:e,day:moment(e,"YYYY-MM-DD").day()},yii.getQueryParams(window.location.search)),dataType:"json",success:function(e){if($("#doctor").removeClass("hidden"),$(".appoint-time").html(""),e.schedule_times.length)for(let t=0;t<e.schedule_times.length;t++)e.schedule_times[t].disabled?$(".appoint-time").append(`<label class="control control-solid control-solid-success control--radio">\n            ${e.schedule_times[t].text}\n            <input type="radio" name="AppointModel[appoint_time]" value="${e.schedule_times[t].value}" disabled />\n                <span class="control__indicator"></span>\n        </label>`):$(".appoint-time").append(`<label class="control control-solid control-solid-success control--radio">\n            ${e.schedule_times[t].text}\n            <input type="radio" name="AppointModel[appoint_time]" value="${e.schedule_times[t].value}"  />\n                <span class="control__indicator"></span>\n        </label>`);else $(".appoint-time").html('<div style="text-align: center;font-size:16pt;color:#ff0000;">ไม่พบเวลาทำการแพทย์ กรุณาเลือกวันนัดหมายใหม่</div>');$("#appoint-form").waitMe("hide"),inputEvent()},error:function(e,t,o){$("#appoint-form").waitMe("hide"),Swal.fire({title:"Error!",text:o,icon:"error",confirmButtonText:"ตกลง"})}})}function objectifyForm(){for(var e=form.serializeArray(),t={},o=0;o<e.length;o++)t[e[o].name]=e[o].value;return t}function ClearForm(){$(".appoint-time").html(""),$('input[name="doc_option"]').prop("checked",!1),$("#doctor").addClass("hidden"),$("#doctor, #doctor_id").val(""),$('input[name="docname"]').prop("checked",!1),dateList=[];var e=moment().format("DD/MM/YYYY");jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setStartDate",e),jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setEndDate",null),jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setDatesDisabled",[]),jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("update",e),$("#appoint-form").trigger("reset")}function randomDoctor(){var e=[],t=[];$.each($("#exampleModal3").find('input[name="docname"]'),function(o,a){e.push($(this).val()),t.push({id:$(this).val(),name:$(this).data("docname")})});var o=e[Math.floor(Math.random()*e.length)],a=t.find(e=>e.id===o);$("#doctor").val(a.name),$("#doctor_id").val(o),$(`input[value="${o}"]`).prop("checked",!0);var i=moment().format("DD/MM/YYYY");jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setStartDate",i),jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setEndDate",null),jQuery("#appointmodel-appoint_date-kvdate").kvDatepicker("setDatesDisabled",[]),GetSchedules(o)}$('input[name="doc_option"]').on("change",function(e){e.preventDefault()}),inputEvent();var form=$("#appoint-form");$("#reset-form").on("click",function(){ClearForm()}),jQuery("#appointmodel-appoint_date-kvdate").on("show",function(){$("#overlay").removeClass("hidden")}),jQuery("#appointmodel-appoint_date-kvdate").on("hide",function(){$("#overlay").addClass("hidden")}),$("#appointmodel-appoint_date-kvdate").kvDatepicker().on("changeDate",function(e){GetScheduleTimes(e.format("yyyy-mm-dd")),$("#appointmodel-appoint_date-kvdate").kvDatepicker("hide")}),$("#btn-random").on("click",function(e){e.preventDefault(),randomDoctor()});var $form=$("#appoint-form");$form.on("beforeSubmit",function(){$form.serialize();var e=objectifyForm();return e["AppointModel[appoint_date]"]?e["AppointModel[appoint_time]"]?($("#appoint-form").waitMe({effect:"roundBounce",color:"#ff518a"}),$.ajax({url:"/app/appoint/save-appoint",type:"POST",data:{...e,appoint_time_from:e["AppointModel[appoint_time]"]?e["AppointModel[appoint_time]"].substring(0,5):"",appoint_time_to:e["AppointModel[appoint_time]"]?e["AppointModel[appoint_time]"].substring(6,11):"",...yii.getQueryParams(window.location.search)},success:function(e){ClearForm();var t=e.appoint;liff.isInClient()&&udhApp.sendMessages([{type:"flex",altText:"ข้อมูลการจอง",contents:{type:"bubble",size:"mega",hero:{type:"image",url:"https://www.udhconnect.info/images/logonew.png",size:"full",aspectRatio:"30:13",aspectMode:"fit",backgroundColor:"#eeeeee"},body:{type:"box",layout:"vertical",spacing:"md",backgroundColor:"#eeeeee",contents:[{type:"text",text:"ใบนัดหมายล่วงหน้า",wrap:!0,weight:"bold",gravity:"center",size:"xxl",align:"center",color:"#62cb31"},{type:"box",layout:"vertical",margin:"lg",spacing:"sm",contents:[{type:"box",layout:"baseline",spacing:"sm",contents:[{type:"text",text:"HN :",color:"#aaaaaa",size:"lg",flex:1},{type:"text",text:t.hn||"-",wrap:!0,size:"lg",color:"#666666",flex:4}]},{type:"box",layout:"baseline",spacing:"sm",contents:[{type:"text",text:"ชื่อ",color:"#aaaaaa",size:"lg",flex:1},{type:"text",text:t.fullname,wrap:!0,size:"lg",color:"#666666",flex:4}]},{type:"box",layout:"baseline",spacing:"sm",contents:[{type:"text",text:"แผนก",color:"#aaaaaa",size:"lg",flex:1},{type:"text",text:t.department_name,wrap:!0,color:"#666666",size:"lg",flex:4}]},{type:"box",layout:"baseline",spacing:"sm",contents:[{type:"text",text:"แพทย์",color:"#aaaaaa",size:"lg",flex:1},{type:"text",text:t.doctor_name,wrap:!0,color:"#666666",size:"lg",flex:4}]},{type:"box",layout:"baseline",spacing:"sm",contents:[{type:"text",text:"วันที่",color:"#aaaaaa",size:"lg",flex:1},{type:"text",text:t.appoint_date,wrap:!0,color:"#666666",size:"lg",flex:4}]},{type:"box",layout:"baseline",spacing:"sm",contents:[{type:"text",text:"เวลา",color:"#aaaaaa",size:"lg",flex:1},{type:"text",text:t.appoint_time+" น.",wrap:!0,size:"lg",color:"#666666",flex:4}]}]}]},footer:{type:"box",layout:"vertical",backgroundColor:"#eeeeee",contents:[{type:"text",text:t.hn?"กรุณากดบัตรคิว ณ จุดบริการ ตามวัน/เวลาที่นัดหมาย!":"กรุณาติดต่อห้องบัตร ตามวัน/เวลาที่นัดหมาย!",size:"xs",color:"#ff0000",style:"normal",align:"center"}]}}}]),Swal.fire({title:"ทำรายการนัดหมายสำเร็จ",text:"",icon:"success",confirmButtonText:"ตกลง",allowOutsideClick:!1}).then(t=>{t.value&&(window.location.href=`/app/appoint/follow-up?hn=${e.hn||""}&appoint_date=${e.appoint_date}&doctor=${e.doctor}&cid=${e.id_card}`)}),$("#appoint-form").waitMe("hide")},error:function(e,t,o){$("#appoint-form").waitMe("hide"),console.log(e);var a=e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("message")?e.responseJSON.message:o;Swal.fire({title:"ไม่สามารถบันทึกข้อมูลได้!",text:a,icon:"error",confirmButtonText:"ตกลง"})}}),!1):(Swal.fire({title:"Oops...!",text:"กรุณาระบุเวลานัด",icon:"warning",confirmButtonText:"ตกลง"}),!1):(Swal.fire({title:"Oops...!",text:"กรุณาระบุวันที่นัด",icon:"warning",confirmButtonText:"ตกลง"}),!1)}),$(window).on("load",function(e){setTimeout(()=>{var e=yii.getQueryParams(window.location.search);if(e.doccode){var t=$("#"+e.doccode);t&&($(".btn-doc-option").removeClass("active"),$("#doctor").val(t.data("docname")),$("#doctor_id").val(t.val()),t.prop("checked",!0),$("#option").prop("checked",!1),$("#option1").prop("checked",!0),$("#doctor").removeClass("hidden"),GetSchedules(e.doccode))}else $("#option").prop("checked",!0)},1e3)});